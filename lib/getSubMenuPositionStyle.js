"use strict";var _reactDom=require("react-dom"),Region=require("region-align"),assign=require("object-assign"),align=require("./align");module.exports=function(a,t){if(!t.menu||!this.didMount)return void(this.prevMenuIndex=-1);var u=t.menuOffset,v=u.left+u.width,w=u.top,x=t.itemProps.index,y=this.prevMenuIndex==x;this.aligning&&!y&&(this.aligning=!1),this.prevMenuIndex=x;var z={position:"absolute",visibility:"hidden",overflow:"hidden",pointerEvents:"none",left:v,top:w,zIndex:1};return this.aligning||y||setTimeout(function(){if(this.didMount){var A=Region.from((0,_reactDom.findDOMNode)(this)),B=Region.from({left:A.left,top:A.top+u.top,width:u.width,height:u.height}),C=this.refs.subMenu&&this.refs.subMenu.isMounted();if(C){var D,E=Region.from(this.refs.subMenu.refs.scrollContainer.getCurrentSizeDOM()),F=E.height,G=align(a,E,/* alignTo */B,a.constrainTo),H=E.height;H<F&&(D=H-a.subMenuConstrainMargin),D&&-1==G/* upwards*/&&(E.top=E.bottom-D);var I=E.left-A.left,J=E.top-A.top;5>Math.abs(I-v)&&(I=v),5>Math.abs(J-w)&&(J=w),this.subMenuPosition=0>I?"left":"right",this.alignOffset={left:I,top:J},this.aligning=!0,this.setState({subMenuMaxHeight:D})}}}.bind(this),0),(y||this.aligning&&this.alignOffset)&&(assign(z,this.alignOffset),z.visibility="visible",delete z.pointerEvents,delete z.overflow),this.aligning=!1,z};